"use strict";(self.webpackChunkfront_documentation=self.webpackChunkfront_documentation||[]).push([[204],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),h=a,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return t?r.createElement(m,i(i({ref:n},u),{},{components:t})):r.createElement(m,i({ref:n},u))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}h.displayName="MDXCreateElement"},8561:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=t(7462),a=(t(7294),t(3905));const o={sidebar_position:8},i="Use webhooks to get real-time updates",s={unversionedId:"guides/webhooks",id:"guides/webhooks",title:"Use webhooks to get real-time updates",description:"Do you want to be proactively informed of your customer activities? You're at the right place! \ud83d\udcaa",source:"@site/resources/partner-api/guides/webhooks.md",sourceDirName:"guides",slug:"/guides/webhooks",permalink:"/partner-api/guides/webhooks",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"sidebar",previous:{title:"Reporting a flight cancellation",permalink:"/partner-api/guides/report-flights"},next:{title:"Multi-planning booking",permalink:"/partner-api/references/multi-planning_booking"}},l={},c=[{value:"Webhook principles",id:"webhook-principles",level:2},{value:"Create a webhook endpoint",id:"create-a-webhook-endpoint",level:2},{value:"Secure your webhook endpoint",id:"secure-your-webhook-endpoint",level:2},{value:"Subscribe to Koala webhooks",id:"subscribe-to-koala-webhooks",level:2},{value:"Error handling",id:"error-handling",level:2},{value:"Example webhook requests",id:"example-webhook-requests",level:2}],u={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"use-webhooks-to-get-real-time-updates"},"Use webhooks to get real-time updates"),(0,a.kt)("p",null,"Do you want to be proactively informed of your customer activities? You're at the right place! \ud83d\udcaa"),(0,a.kt)("p",null,"This is the documentation for version 2 of our webhooks. Looking for the version 1? Look ",(0,a.kt)("a",{parentName:"p",href:"/partner-api/archived/webhooks-v1"},"there"),". "),(0,a.kt)("h2",{id:"webhook-principles"},"Webhook principles"),(0,a.kt)("p",null,"A webhook sends an HTTP request to your application's URL in response to an activity in Koala's API.\nFor example, you can configure a webhook to receive requests when a customer creates a contract, or when a contract is claimed."),(0,a.kt)("p",null,"Subscribing to our webhook can help you with:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Claim management"),": If you handle claim management, our webhook will keep you informed of the current status of the claim."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Customer service"),": You can feed your CRM so that your customer service is aware of everything happening with your customers."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Customer experience"),": You can contact disrupted travellers to offer them special assistance or care.")),(0,a.kt)("p",null,"Claims notifications are sent ",(0,a.kt)("strong",{parentName:"p"},"as soon as we have determined internally the status of the claims")," (usually,\nexpect to receive it a few hours after the event has occurred, at the latest 48 hours)."),(0,a.kt)("h2",{id:"create-a-webhook-endpoint"},"Create a webhook endpoint"),(0,a.kt)("p",null,"To start using Koala webhooks, you must set up an HTTP endpoint on your application that can accept unauthenticated webhook request with a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," method.\nThe URL path of the endpoint can be anything, for example ",(0,a.kt)("inlineCode",{parentName:"p"},"/koala_webhooks"),". "),(0,a.kt)("p",null,"The expected request body is described in the ",(0,a.kt)("a",{parentName:"p",href:"/webhooks-swagger"},"Swagger")," and the request will contain the following headers:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Accept": "application/json",\n  "Content-Type": "application/json",\n  "Koala-Signature": "<generated_signature>",\n  "Webhook-Version": "v2"\n}\n')),(0,a.kt)("p",null,"The purpose of ",(0,a.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header is explained in the section below. "),(0,a.kt)("h2",{id:"secure-your-webhook-endpoint"},"Secure your webhook endpoint"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header is there to verify that the request truly comes from Koala. "),(0,a.kt)("p",null,"This is achieved by comparing the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," against a hash of the request body. "),(0,a.kt)("p",null,"This hash is created using the algorithm SHA256 with the secret you provided us, and is encoded into hexadecimal."),(0,a.kt)("p",null,"Here is an example implementation of how to verify the signature using JavaScript:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const crypto = require("crypto");\n\nfunction verifySignature(request, secret) {\n  const hmac = crypto.createHmac("sha256", secret);\n  \n  // The hash will use the *raw* body of the request\n  hmac.update(request.body, "utf8");\n  \n  // Creates the hash using the hexadecimal encoding\n  const digest = hmac.digest("hex");\n  \n  return digest === request.headers["Koala-Signature"];\n}\n')),(0,a.kt)("h2",{id:"subscribe-to-koala-webhooks"},"Subscribe to Koala webhooks"),(0,a.kt)("p",null,"Once the webhook endpoint is set up on your side, you will need to provide us with:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A URL on which we can POST the events"),(0,a.kt)("li",{parentName:"ul"},"A secret key used to secure the webhook")),(0,a.kt)("p",null,"You can optionally choose which events you receive. Events are listed in the ",(0,a.kt)("a",{parentName:"p",href:"/webhooks-swagger"},"Swagger"),". "),(0,a.kt)("h2",{id:"error-handling"},"Error handling"),(0,a.kt)("p",null,"If you fail to process the webhook request (downtime due to scheduled maintenance, network error, schema validation error, etc.), we will retry the request during 7 days after it failed."),(0,a.kt)("p",null,"Our system will consider the webhook request failed if the response code is different from ",(0,a.kt)("inlineCode",{parentName:"p"},"200")," or if the request times out after 5 seconds."),(0,a.kt)("h2",{id:"example-webhook-requests"},"Example webhook requests"),(0,a.kt)("p",null,"Here is an example webhook request body for a claim event:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "claim": {\n      "claimedAt": "2023-06-23T10:09:04.546Z",\n      "compensation": {\n        "amount": 80,\n        "currency": "EUR"\n      },\n      "contract": {\n        "coveredEvent": {\n          "journeys": [{\n            "arrivalAirport": {\n              "city": "New York",\n              "iata": "JFK",\n              "name": "John F. Kennedy International Airport"\n            },\n            "arrivalDate": "2023-07-30T08:35:00.000Z",\n            "departureAirport": {\n              "city": "Paris",\n              "iata": "CDG",\n              "name": "Charles de Gaulle Airport"\n            },\n            "departureDate": "2023-07-30T07:10:00.000Z",\n            "number": "AF8223"\n          }],\n          "stays": []\n        },\n        "createdAt": "2023-06-23T10:08:40.861Z",\n        "id": "395c0b75-456a-4c34-b85e-f2d796241643",\n        "priceDetails": {\n          "coveredEventPrice": 100,\n          "currency": "EUR",\n          "retailPremiumTaxesIncluded": 15\n        },\n        "product": {\n          "name": "Flex",\n          "type": "WITHDRAWAL"\n        },\n        "subscription": {\n          "id": "c779e8da-4f53-4b58-95bc-a6702588fee8",\n          "bookingNumber": "6TG9896HTM",\n          "customer": {\n            "email": "john.doe@gmail.com",\n            "firstName": "John",\n            "lastName": "Doe"\n          }\n        },\n        "travelers": [\n          {\n            "ageRange": "ADULT",\n            "countryOfResidence": {\n              "id": "FR",\n              "name": "France"\n            }\n          }\n        ]\n      },\n      "reason": {\n        "type": "CANCELATION"\n      },\n      "status": "REFUNDED"\n    }\n  },\n  "event": "claim.updated"\n}\n')),(0,a.kt)("p",null,"The claim was triggered when the customer canceled his booking with number ",(0,a.kt)("inlineCode",{parentName:"p"},"6TG9896HTM"),", making him eligible for an 80\u20ac compensation. "),(0,a.kt)("p",null,"In this example, if the secret you provided us with was ",(0,a.kt)("inlineCode",{parentName:"p"},"my_secret")," then the value of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header\nwould be ",(0,a.kt)("inlineCode",{parentName:"p"},"98bdc70d97aa5b6ae3e90254e3ac81e0c2dbd9b2f2ac780d5ab2a2d52758f480"),"."),(0,a.kt)("p",null,"Here is another example webhook request body for an event triggered by the creation of a contract:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "contract": {\n      "coveredEvent": {\n        "journeys": [{\n          "arrivalAirport": {\n            "city": "New York",\n            "iata": "JFK",\n            "name": "John F. Kennedy International Airport"\n          },\n          "arrivalDate": "2023-07-30T08:35:00.000Z",\n          "departureAirport": {\n            "city": "Paris",\n            "iata": "CDG",\n            "name": "Charles de Gaulle Airport"\n          },\n          "departureDate": "2023-07-30T07:10:00.000Z",\n          "number": "AF8223"\n        }],\n        "stays": []\n      },\n      "createdAt": "2023-06-23T10:08:40.861Z",\n      "id": "395c0b75-456a-4c34-b85e-f2d796241643",\n      "maximumExpectedCompensation": {\n        "amount": 80.5,\n        "currency": "EUR"\n      },\n      "priceDetails": {\n        "coveredEventPrice": 100,\n        "currency": "EUR",\n        "retailPremiumTaxesIncluded": 15\n      },\n      "product": {\n        "name": "Flex",\n        "type": "WITHDRAWAL"\n      },\n      "subscription": {\n        "id": "c779e8da-4f53-4b58-95bc-a6702588fee8",\n        "bookingNumber": "6TG9896HTM",\n        "customer": {\n          "email": "john.doe@gmail.com",\n          "firstName": "John",\n          "lastName": "Doe"\n        }\n      },\n      "travelers": [\n        {\n          "ageRange": "ADULT",\n          "countryOfResidence": {\n            "id": "FR",\n            "name": "France"\n          },\n          "firstName": "Koala",\n          "id": "9e7dc67e-ee41-4a73-9abf-de49c669f63c",\n          "lastName": "Go"\n        }\n      ]\n    }\n  },\n  "event": "contract.created"\n}\n')))}d.isMDXComponent=!0}}]);