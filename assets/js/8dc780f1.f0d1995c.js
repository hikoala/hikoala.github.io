"use strict";(self.webpackChunkfront_documentation=self.webpackChunkfront_documentation||[]).push([[204],{7605:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var a=n(6033),o=n(7839),i=(n(2735),n(9530)),r=["components"],s={sidebar_position:5},l="Be informed of claims status",c={unversionedId:"guides/webhooks",id:"guides/webhooks",title:"Be informed of claims status",description:"Do you want to be proactively informed of your customer claim status? You're at the right place! \ud83d\udcaa",source:"@site/resources/partner-api/guides/webhooks.md",sourceDirName:"guides",slug:"/guides/webhooks",permalink:"/partner-api/guides/webhooks",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"sidebar",previous:{title:"Declare a booking cancellation",permalink:"/partner-api/guides/contracts"},next:{title:"Tracking conversion rate",permalink:"/partner-api/guides/conversion-rate"}},u={},d=[{value:"Webhook principles",id:"webhook-principles",level:3},{value:"When do I need to interface with Koala&#39;s webhook?",id:"when-do-i-need-to-interface-with-koalas-webhook",level:3},{value:"How does it work?",id:"how-does-it-work",level:3},{value:"Subscribing to the claim webhook: Headers",id:"subscribing-to-the-claim-webhook-headers",level:3},{value:"Subscribing to the claim webhook: Body",id:"subscribing-to-the-claim-webhook-body",level:3},{value:"Verifying Koala&#39;s request",id:"verifying-koalas-request",level:3},{value:"Example of notification",id:"example-of-notification",level:3}],p={toc:d};function m(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"be-informed-of-claims-status"},"Be informed of claims status"),(0,i.kt)("p",null,"Do you want to be proactively informed of your customer claim status? You're at the right place! \ud83d\udcaa"),(0,i.kt)("h3",{id:"webhook-principles"},"Webhook principles"),(0,i.kt)("p",null,"We have designed webhooks to which you can subscribe to receive notifications of your customers' claims."),(0,i.kt)("p",null,"You will receive notifications from us ",(0,i.kt)("strong",{parentName:"p"},"as soon as we have determined internally the status of the claims")," (usually,\nexpect to receive a notification within a few hours after the event has occurred, at the latest 48 hours). By\nsubscribing to our webhook, you will get the same information we do at the same time!"),(0,i.kt)("h3",{id:"when-do-i-need-to-interface-with-koalas-webhook"},"When do I need to interface with Koala's webhook?"),(0,i.kt)("p",null,"Subscribing to our webhook can help you with:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Claim management"),": If you handle claim management, our webhook will keep you informed of the eligibility of the claim."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Customer service"),": You can feed your CRM with claim details so that your customer service is aware of everything\nhappening with your customers."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Customer experience"),": You can contact disrupted travellers to offer them special assistance or care.")),(0,i.kt)("h3",{id:"how-does-it-work"},"How does it work?"),(0,i.kt)("p",null,"To subscribe to our webhook, you will need to send us:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A URL on which we can POST information"),(0,i.kt)("li",{parentName:"ul"},"A secret of your choice.")),(0,i.kt)("p",null,"Once received, Koala will configure your webhook and notify your URL via HTTP POST with all the details of the claims.\n",(0,i.kt)("strong",{parentName:"p"},"Your role will be to interpret the notification received and use it for your claim management.")),(0,i.kt)("p",null,"You will receive a notification per contract when a contract becomes eligible for compensation and/or when we receive the bank details for payment.\ud83e\udd13"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you are interested in receiving non-eligible claims or any extra information, please let us know!"))),(0,i.kt)("h3",{id:"subscribing-to-the-claim-webhook-headers"},"Subscribing to the claim webhook: Headers"),(0,i.kt)("p",null,"The webhook will contain the following set of request headers:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Accept": "application/json",\n  "Content-Type": "application/json",\n  "Koala-Signature": "<generated_signature>"\n}\n')),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},(0,i.kt)("strong",{parentName:"p"},"Koala-Signature")," is a hash generated on the fly using your client secret and the request body itself, we use it to certify the\nauthenticity of the request. This means each request will have a different ",(0,i.kt)("strong",{parentName:"p"},"Koala-Signature")," hash."))),(0,i.kt)("h3",{id:"subscribing-to-the-claim-webhook-body"},"Subscribing to the claim webhook: Body"),(0,i.kt)("p",null,"You must configure your webhook to accept the following type of body:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n  "claimedAt": DateTime,\n  "compensation"?: {\n    "amount": number,\n    "currency": string (3-letters code),\n  } | undefined,\n  "contract": {\n    "coveredEvent": Flight | Journey | Trip,\n    "createdAt": DateTime,\n    "subscription": {\n      "bookingNumber": string\n    }\n  },\n  "reason"?: {\n    "type": string (\'CANCELATION\' | \'FLIGHT_CANCELED\' | \'FLIGHT_DELAYED\' | \'FLIGHT_DIVERTED\' | \'MISSED_CONNECTION\'),\n  } | undefined,\n  "status": string ("ACCEPTED" | "REFUNDABLE" | "REFUNDED" | "AUTOMATICALLY_REJECTED" | "REJECTED" | "MANUAL_VERIFICATION_NEEDED"),\n}\n')),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"For all possible claim statuses, please check our ",(0,i.kt)("a",{parentName:"em",href:"https://partner.api.hikoala.co/doc/#operation/ContractsClaimsController-create"},"Open API doc")," on claim creation response.")),(0,i.kt)("p",null,"Here are the different ",(0,i.kt)("inlineCode",{parentName:"p"},"coveredEvent")," types:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Flight {\n  "arrivalAirport": {\n    "city": string,\n    "iata": string (3-letters code),\n    "name": string,\n  },\n  "arrivalDate": DateTime,\n  "departureAirport": {\n    "city": string,\n    "iata": string (3-letters code),\n    "name": string,\n  },\n  "departureDate": DateTime,\n  "number": string (airline code + flight number),\n}\n\nJourney {\n  "flights": Flight[],\n}\n\nStay {\n  "address": {\n    "country": {\n      "id": string (2-letters code),\n      "name": string,\n    },\n    "line1"?: string | undefined,\n    "line2"?: string | udefined,\n    "line3"?: string | undefined,\n    "line4"?: string | undefined,\n    "locality"?: string | undefined,\n    "postcode"?: string | undefined,\n    "region"?: string | undefined,\n  },\n  "endDate": DateTime,\n  "name": string,\n  "startDate": DateTime,\n}\n\nTrip {\n  "journeys": Journey[] | [],\n  "stays": Stay[] | [],\n}\n')),(0,i.kt)("h3",{id:"verifying-koalas-request"},"Verifying Koala's request"),(0,i.kt)("p",null,"To certify that the notification truly comes from Koala, you will need to compare the ",(0,i.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header against a hash of the request body with the secret you gave us."),(0,i.kt)("p",null,"To do so, you can run the following: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const crypto = require("crypto");\n\nfunction verifySignature(request, secret) {\n  const hmac = crypto.createHmac("sha256", secret);\n  hmac.update(JSON.stringify(request.body), "utf8");\n  const digest = hmac.digest("hex");\n  return digest === request.headers["Koala-Signature"];\n}\n')),(0,i.kt)("h3",{id:"example-of-notification"},"Example of notification"),(0,i.kt)("p",null,"Please find below an example of notification for a delayed flight between Paris and New York:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "claimedAt": "2022-02-07T11:31:27.000Z",\n  "compensation": {\n    "amount": 100,\n    "currency": "EUR"\n  },\n  "contract": {\n    "coveredEvent": {\n      "arrivalAirport": {\n        "city": "New York",\n        "iata": "JFK",\n        "name": "John F. Kennedy International Airport"\n      },\n      "arrivalDate": "2021-07-30T08:35:00.000Z",\n      "departureAirport": {\n        "city": "Paris",\n        "iata": "CDG",\n        "name": "Charles de Gaulle Airport"\n      },\n      "departureDate": "2021-07-30T07:10:00.000Z",\n      "number": "AF8223"\n    },\n    "createdAt": "2021-12-05T18:42:55.000Z",\n    "subscription": {\n      "bookingNumber": "6TG9896HTM"\n    }\n  },\n  "reason": {\n    "type": "FLIGHT_DELAYED"\n  },\n  "status": "ACCEPTED"\n}\n')),(0,i.kt)("p",null,"Here you can see that booking ",(0,i.kt)("inlineCode",{parentName:"p"},"6TG9896HTM")," has had a delayed flight allowing it to be eligible for 100 EUR. "),(0,i.kt)("br",null),(0,i.kt)("p",null,'If the secret you gave us is "my_secret", we will hash the payload above with it, and the ',(0,i.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header will be:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"4d03d41bf8cbbb3382896f9336d3c109e652774baf638b23b0aecf5d895ef9d1")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"For GDPR reasons, we are not sharing any information about the customer details. You will need to use the field ",(0,i.kt)("inlineCode",{parentName:"p"},"bookingNumber")," to associate the claim to the right booking. \ud83d\udc28"))))}m.isMDXComponent=!0},9530:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(2735);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=o,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||i;return n?a.createElement(h,r(r({ref:t},u),{},{components:n})):a.createElement(h,r({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);