"use strict";(self.webpackChunkfront_documentation=self.webpackChunkfront_documentation||[]).push([[204],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),h=r,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||a;return n?o.createElement(m,i(i({ref:t},u),{},{components:n})):o.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8561:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=n(11),r=(n(7294),n(3905));const a={sidebar_position:5},i="Be informed of claims status",l={unversionedId:"guides/webhooks",id:"guides/webhooks",title:"Be informed of claims status",description:"Do you want to be proactively informed of your customer claim status? You're at the right place! \ud83d\udcaa",source:"@site/resources/partner-api/guides/webhooks.md",sourceDirName:"guides",slug:"/guides/webhooks",permalink:"/partner-api/guides/webhooks",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"sidebar",previous:{title:"Declare a booking cancellation",permalink:"/partner-api/guides/contracts"},next:{title:"Tracking conversion rate",permalink:"/partner-api/guides/conversion-rate"}},s={},c=[{value:"Webhook principles",id:"webhook-principles",level:3},{value:"When do I need to interface with Koala&#39;s webhook?",id:"when-do-i-need-to-interface-with-koalas-webhook",level:3},{value:"How does it work?",id:"how-does-it-work",level:3},{value:"Subscribing to the claim webhook: Headers",id:"subscribing-to-the-claim-webhook-headers",level:3},{value:"Subscribing to the claim webhook: Body",id:"subscribing-to-the-claim-webhook-body",level:3},{value:"Verifying Koala&#39;s request",id:"verifying-koalas-request",level:3},{value:"What happens if the webhook request fails?",id:"what-happens-if-the-webhook-request-fails",level:3},{value:"Example of notification",id:"example-of-notification",level:3}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"be-informed-of-claims-status"},"Be informed of claims status"),(0,r.kt)("p",null,"Do you want to be proactively informed of your customer claim status? You're at the right place! \ud83d\udcaa"),(0,r.kt)("h3",{id:"webhook-principles"},"Webhook principles"),(0,r.kt)("p",null,"We have designed webhooks to which you can subscribe to receive notifications of your customers' claims."),(0,r.kt)("p",null,"You will receive notifications from us ",(0,r.kt)("strong",{parentName:"p"},"as soon as we have determined internally the status of the claims")," (usually,\nexpect to receive a notification within a few hours after the event has occurred, at the latest 48 hours). By\nsubscribing to our webhook, you will get the same information we do at the same time!"),(0,r.kt)("h3",{id:"when-do-i-need-to-interface-with-koalas-webhook"},"When do I need to interface with Koala's webhook?"),(0,r.kt)("p",null,"Subscribing to our webhook can help you with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Claim management"),": If you handle claim management, our webhook will keep you informed of the eligibility of the claim."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Customer service"),": You can feed your CRM with claim details so that your customer service is aware of everything\nhappening with your customers."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Customer experience"),": You can contact disrupted travellers to offer them special assistance or care.")),(0,r.kt)("h3",{id:"how-does-it-work"},"How does it work?"),(0,r.kt)("p",null,"To subscribe to our webhook, you will need to send us:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A URL on which we can POST information"),(0,r.kt)("li",{parentName:"ul"},"A secret of your choice.")),(0,r.kt)("p",null,"Once received, Koala will configure your webhook and notify your URL via HTTP POST with all the details of the claims.\n",(0,r.kt)("strong",{parentName:"p"},"Your role will be to interpret the notification received and use it for your claim management.")),(0,r.kt)("p",null,"You will receive a notification per contract when a contract becomes eligible for compensation and/or when we receive the bank details for payment.\ud83e\udd13"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you are interested in receiving non-eligible claims or any extra information, please let us know!")),(0,r.kt)("h3",{id:"subscribing-to-the-claim-webhook-headers"},"Subscribing to the claim webhook: Headers"),(0,r.kt)("p",null,"The webhook will contain the following set of request headers:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Accept": "application/json",\n  "Content-Type": "application/json",\n  "Koala-Signature": "<generated_signature>"\n}\n')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Koala-Signature")," is a hash generated on the fly using your client secret and the request body itself, we use it to certify the\nauthenticity of the request. This means each request will have a different ",(0,r.kt)("strong",{parentName:"p"},"Koala-Signature")," hash.")),(0,r.kt)("h3",{id:"subscribing-to-the-claim-webhook-body"},"Subscribing to the claim webhook: Body"),(0,r.kt)("p",null,"You must configure your webhook to accept the following type of body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "claimedAt": DateTime,\n  "compensation"?: {\n    "amount": number,\n    "currency": string (3-letters code),\n  } | undefined,\n  "contract": {\n    "coveredEvent": Flight | Journey | Trip,\n    "createdAt": DateTime,\n    "subscription": {\n      "bookingNumber": string\n    }\n  },\n  "reason"?: {\n    "type": string (\'CANCELATION\' | \'FLIGHT_CANCELED\' | \'FLIGHT_DELAYED\' | \'FLIGHT_DIVERTED\' | \'MISSED_CONNECTION\'),\n  } | undefined,\n  "status": string ("ACCEPTED" | "REFUNDABLE" | "REFUNDED" | "AUTOMATICALLY_REJECTED" | "REJECTED" | "MANUAL_VERIFICATION_NEEDED"),\n}\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"For all possible claim statuses, please check our ",(0,r.kt)("a",{parentName:"em",href:"https://partner.api.hikoala.co/doc/#operation/ContractsClaimsController-create"},"Open API doc")," on claim creation response.")),(0,r.kt)("p",null,"Here are the different ",(0,r.kt)("inlineCode",{parentName:"p"},"coveredEvent")," types:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Flight {\n  "arrivalAirport": {\n    "city": string,\n    "iata": string (3-letters code),\n    "name": string,\n  },\n  "arrivalDate": DateTime,\n  "departureAirport": {\n    "city": string,\n    "iata": string (3-letters code),\n    "name": string,\n  },\n  "departureDate": DateTime,\n  "number": string (airline code + flight number),\n}\n\nJourney {\n  "flights": Flight[],\n}\n\nStay {\n  "address": {\n    "country": {\n      "id": string (2-letters code),\n      "name": string,\n    },\n    "line1"?: string | undefined,\n    "line2"?: string | udefined,\n    "line3"?: string | undefined,\n    "line4"?: string | undefined,\n    "locality"?: string | undefined,\n    "postcode"?: string | undefined,\n    "region"?: string | undefined,\n  },\n  "endDate": DateTime,\n  "name": string,\n  "startDate": DateTime,\n}\n\nTrip {\n  "journeys": Journey[] | [],\n  "stays": Stay[] | [],\n}\n')),(0,r.kt)("h3",{id:"verifying-koalas-request"},"Verifying Koala's request"),(0,r.kt)("p",null,"To certify that the notification truly comes from Koala, you will need to compare the ",(0,r.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header against a hash of the request body with the secret you gave us."),(0,r.kt)("p",null,"To do so, you can run the following: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const crypto = require("crypto");\n\nfunction verifySignature(request, secret) {\n  const hmac = crypto.createHmac("sha256", secret);\n  hmac.update(JSON.stringify(request.body), "utf8");\n  const digest = hmac.digest("hex");\n  return digest === request.headers["Koala-Signature"];\n}\n')),(0,r.kt)("h3",{id:"what-happens-if-the-webhook-request-fails"},"What happens if the webhook request fails?"),(0,r.kt)("p",null,"Sometimes, your server hosting your webhook will fail to receive the claim due to different types of reason (downtime due to scheduled maintenance, network error, schema validation error, etc...)."),(0,r.kt)("p",null,"For these cases we have implemented a retry system. If your webhook times out or does not reply with a successful HTTP code (2xx), we will retry sending the claim. The worker will try sending the claim again during some hours.\nBut don't worry, we will not spam your webhook! Our system will space out requests increasingly."),(0,r.kt)("h3",{id:"example-of-notification"},"Example of notification"),(0,r.kt)("p",null,"Please find below an example of notification for a delayed flight between Paris and New York:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "claimedAt": "2022-02-07T11:31:27.000Z",\n  "compensation": {\n    "amount": 100,\n    "currency": "EUR"\n  },\n  "contract": {\n    "coveredEvent": {\n      "arrivalAirport": {\n        "city": "New York",\n        "iata": "JFK",\n        "name": "John F. Kennedy International Airport"\n      },\n      "arrivalDate": "2021-07-30T08:35:00.000Z",\n      "departureAirport": {\n        "city": "Paris",\n        "iata": "CDG",\n        "name": "Charles de Gaulle Airport"\n      },\n      "departureDate": "2021-07-30T07:10:00.000Z",\n      "number": "AF8223"\n    },\n    "createdAt": "2021-12-05T18:42:55.000Z",\n    "subscription": {\n      "bookingNumber": "6TG9896HTM"\n    }\n  },\n  "reason": {\n    "type": "FLIGHT_DELAYED"\n  },\n  "status": "ACCEPTED"\n}\n')),(0,r.kt)("p",null,"Here you can see that booking ",(0,r.kt)("inlineCode",{parentName:"p"},"6TG9896HTM")," has had a delayed flight allowing it to be eligible for 100 EUR. "),(0,r.kt)("br",null),(0,r.kt)("p",null,'If the secret you gave us is "my_secret", we will hash the payload above with it, and the ',(0,r.kt)("inlineCode",{parentName:"p"},"Koala-Signature")," header will be:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"4d03d41bf8cbbb3382896f9336d3c109e652774baf638b23b0aecf5d895ef9d1")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"For GDPR reasons, we are not sharing any information about the customer details. You will need to use the field ",(0,r.kt)("inlineCode",{parentName:"p"},"bookingNumber")," to associate the claim to the right booking. \ud83d\udc28")))}p.isMDXComponent=!0}}]);